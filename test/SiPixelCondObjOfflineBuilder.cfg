process PEDESTALS = {

   service = MessageLogger
{
   untracked string threshold = "INFO"
}
  # MessageLogger
  #include "FWCore/MessageService/data/MessageLogger.cfi"

#  source = EmptySource { untracked int32 maxEvents = 1 untracked uint32 firstRun = 1 untracked uint32 numberEventsInRun = 1 }
  source = EmptyIOVSource { string timetype = "runnumber" untracked uint32 firstRun = 1 untracked uint32 lastRun = 1 uint32 interval = 1 }

  # Initialize magnetic field
  include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"

  # Tracker SimGeometryXML
  include "Geometry/TrackerSimData/data/trackerSimGeometryXML.cfi"

  # Tracker Geometry Builder
  include "Geometry/TrackerGeometryBuilder/data/trackerGeometry.cfi"

  # Tracker Numbering Builder
  include "Geometry/TrackerNumberingBuilder/data/trackerNumberingGeometry.cfi"

  # Gain Calibration Service
  include "CondTools/SiPixel/data/SiPixelGainCalibrationService.cfi"

  module SiPixelCondObjOfflineBuilder= SiPixelCondObjOfflineBuilder {

    # Max number of detector modules (whole detector > 1500)
	 int32  numberOfModules = 2000
    # Append DataBase payload to existing file
         untracked bool   appendMode = false
    # DB record name
      string record= "SiPixelGainCalibrationOfflineRcd"
    # Calibration from input file or random number generator
	 bool   fromFile = false
	 string fileName = "../macros/phCalibrationFit_C0.dat"
    # Parameters for random number generator
         double meanPed  = 28.2
         double rmsPed   =   2.75 # at 65 electrons / ADC count, this responds to 500 electrons
#	double rmsPed = 0.0
         double meanGain =  2.8
         double rmsGain  =   0.14  # 5% variation
#	double rmsGain = 0.0
	using SiPixelGainCalibrationServiceParameters
  }

  
  #include "CondCore/DBCommon/data/CondDBCommon.cfi"
  #replace CondDBCommon.connect = "sqlite_file:prova.db"

  service = PoolDBOutputService {
    #
    # For Development DataBase
    #
    #string connect = "oracle://cms_orcoff_int2r/CMS_COND_PIXEL"
    #
    # For SQLite
    #
    string connect = "sqlite_file:/afs/cern.ch/user/f/friis/scratch0/prova.db"
    #
    #
    VPSet toPut={ {string record= "SiPixelGainCalibrationOfflineRcd" string tag ="V2_trivial_TBuffer_startup"} } 
    #
    untracked string BlobStreamerName="TBufferBlobStreamingService"
    #
    PSet DBParameters = { 
	untracked string authenticationPath = "/afs/cern.ch/cms/DB/conddb"  
	#untracked string authenticationPath = ""
	untracked int32 messageLevel = 3
	}
  }

  path p = { SiPixelCondObjOfflineBuilder }

  module print = AsciiOutputModule {}
  endpath ep = { print }
}
